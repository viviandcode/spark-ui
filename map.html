<!DOCTYPE HTML>
<html lang="zh-CN">
	<head>
		<meta charset="UTF-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">

		<title>Map - Pixel Spark</title>
		<meta name="keywords" content="key words">
		<meta name="description" content="Pixel Spark">
		<link rel="icon" href="images/favicon.ico" mce_href="images/favicon.ico" type="image/x-icon">

		<link rel="stylesheet" href="http://cdn.bootcss.com/bootstrap/3.3.5/css/bootstrap.min.css" type="text/css"  media="all">
		<link rel="stylesheet" href="css/style.css" type="text/css"  media="all">

		<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
		<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
		<!--[if lt IE 9]>
			<script src="http://cdn.bootcss.com/html5shiv/3.7.2/html5shiv.min.js"></script>
			<script src="http://cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
		<![endif]-->

		<link rel="stylesheet" href="http://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.css" type="text/css"  media="all">
	</head>
	<body>
		<div class="container">
			<nav class="navbar navbar-default" role="navigation" id="nav">
			  <div class="container-fluid">
			    <!-- Brand and toggle get grouped for better mobile display -->
			    <div class="navbar-header">
			      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#main-menu">
			        <span class="sr-only">Toggle navigation</span>
			        <span class="icon-bar"></span>
			        <span class="icon-bar"></span>
			        <span class="icon-bar"></span>
			      </button>
			      <a class="navbar-brand pixel-font" href="#">Pixel Spark</a>
			    </div>
			    <!-- Collect the nav links, forms, and other content for toggling -->
			    <div class="collapse navbar-collapse" id="main-menu">
			      <ul class="nav navbar-nav navbar-right">
							<li><a href="#"><i class="fa fa-github" aria-hidden="true"></i> Github</a></li>
							<li><a href="#"><i class="fa fa-linkedin" aria-hidden="true"></i> Linkedin</a></li>
			        <li><a href="#"><i class="fa fa-pencil" aria-hidden="true"></i> Blog</a></li>
							<li class="active"><a href="#"><i class="fa fa-map-marker" aria-hidden="true"></i> Mark</a></li>
							<li class="dropdown">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">Category <span class="caret"></span></a>
								<ul class="dropdown-menu" role="menu">
									<li><a href="#">Blog</a></li>
									<li class="divider"></li>
									<li><a href="#">膜蛤</a></li>
									<li><a href="#">续一秒</a></li>
									<li class="divider"></li>
									<li><a href="#">Mark</a></li>
									<li><a href="#">Code</a></li>
								</ul>
							</li>
			      </ul>
			    </div><!-- /.navbar-collapse -->
			  </div><!-- /.container-fluid -->
			</nav>

			<div class="panel panel-default">
				<div class="row" id="map-nav">
					<div class="col-md-12">
						<a class="guider" lng="116.6045142761" lat="27.6883215871">test</a>
						<a class="guider" lng="107.2045142761" lat="29.6883215871">test2</a>
					</div>
				</div>
				<div id="map" tabindex="0"></div>
			</div>

		</div>
		<script src="http://cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
		<script src="http://cdn.bootcss.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
		<script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=jxgatw3PjSIfaimBHwrwiXzTwy05zTzC"></script>
		<script type="text/javascript">
			// 百度地图API功能
			var map = new BMap.Map("map");        // 创建Map实例
			map.centerAndZoom(new BMap.Point(106.6045142761, 29.6883215871), 10);  // 初始化地图，设置中心点坐标和地图级别，最后一个定位的坐标

			map.enableScrollWheelZoom(true);     //开启鼠标滚轮缩放
			map.enableContinuousZoom();    			 //启用地图惯性拖拽

			map.setMapStyle({										 //地图风格设置
			  styleJson:[
					{
						"featureType": "highway",
						"elementType": "geometry",
						"stylers": {
							"color": "#ffffff",
							"hue": "#ffffff",
							"weight": "1"
						}
					},
					{
						"featureType": "subway",
						"elementType": "all",
						"stylers": {
							"visibility": "off"
						}
					},
					{
						"featureType": "railway",
						"elementType": "all",
						"stylers": {
							"visibility": "off"
						}
					},
					{
						"featureType": "poi",
						"elementType": "all",
						"stylers": {
							"visibility": "off"
						}
					},
				]
			});

			var points = [        //坐标点数据集合
				{
					"id":0,
					"date":"2017-02-21",
					"title":"title1",
					"local":"local1",
					"lng":116.6045142761,
					"lat":27.6883215871,
				},
				{
					"id":1,
					"date":"2017-03-03",
					"title":"title2",
					"local":"local2",
					"lng":106.6045142761,
					"lat":29.6883215871,
				},
				{
					"id":2,
					"date":"2017-04-03",
					"title":"title3",
					"local":"local3",
					"lng":107.2045142761,
					"lat":29.6883215871,
				},
			];

			//生成标记点
			for (var i = 0, count = points.length; i < count; i ++) {
				var point_array = points[i];
				var point = new BMap.Point(point_array.lng, point_array.lat);
				var marker = new BMap.Marker(point);

				var Content =
				"<div>" +
				"<h4 style='margin:0 0 5px 0;padding:0.2em 0'>"+ point_array.title +"</h4>" +
				"<img style='float:right;margin:4px' id='imgDemo' src='http://app.baidu.com/map/images/tiananmen.jpg' width='139' height='104' title='"+ point_array.title +"'/>" +
				"<p style='margin:0;line-height:1.5;font-size:13px;text-indent:2em'>"+ point_array.date +":"+ point_array.local +"</p>" +
				"</div>";

				map.addOverlay(marker);

				addInfoWindow(Content, marker);

				var label = new BMap.Label("<i class='fa fa-male' aria-hidden='true'></i> "+point_array.title,{offset:new BMap.Size(20,0)});
				marker.setLabel(label);
			}

			//添加信息窗体函数
			function addInfoWindow(content, marker){
				var infoWindow = new BMap.InfoWindow(content);  // 创建信息窗口对象
				marker.addEventListener("click", function(){
					 this.openInfoWindow(infoWindow);
					 //图片加载完毕重绘infowindow
					 document.getElementById('imgDemo').onload = function (){
						 infoWindow.redraw();   //防止在网速较慢，图片未加载时，生成的信息框高度比图片的总高度小，导致图片部分被隐藏
					 }
				});
			}

			GoToMarker("#map-nav", 13);
			//选择 #map-nav 下带坐标参数的链接，并绑定点击事件
			function GoToMarker(WraperSelector , zoom) {
				var markers = document.querySelectorAll(WraperSelector + " a.guider"); //querySelectorAll 返回非实时nodeList
				for (var i = 0, count = markers.length; i < count; i++) {
					markers[i].addEventListener("click", function(){
						var lng = this.getAttribute("lng");
						var lat = this.getAttribute("lat");
						map.centerAndZoom(new BMap.Point(lng, lat), zoom);
					});
				}
			}
		</script>
	</body>
</html>
